<!-- index.html (Referenz: Dark, hellblau/violett; Karte + klickbare Punkte; Panel mit AQI US & Verkehr; Verlauf über mehrere Monate) -->
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smog Bhārat — Luftqualität & Verkehr in Indien</title>
  <meta name="description" content="Wähle eine Stadt in Indien und sieh Luftqualität (AQI US) & Verkehrsbelastung – live und als Verlauf." />

  <!-- Fonts & Libs -->
  <link href="https://api.fontshare.com/v2/css?f[]=clash-grotesk@1&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
  <script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js" defer></script>

  <link href="./css/style.css?v=2" rel="stylesheet">
</head>
<body>
  <div class="wrap">
    <header class="shell">
      <div class="nav">
        <div class="brand">
          <strong>SMOG BHĀRAT</strong>
          <span>Luftqualität & Verkehr in Indien</span>
        </div>
        <div class="spacer"></div>
        <nav class="navlinks" aria-label="Hauptmenü">
          <a href="#map">Karte</a>
          <a href="#graph">Verlauf</a>
          <a href="#about">Über</a>
        </nav>
      </div>
    </header>

    <main class="shell">
      <section class="map-col">
        <div id="map" aria-label="Karte von Indien"></div>
      </section>

      <aside class="panel" id="panel" aria-live="polite">
        <div class="header">
          <div class="city" id="city">Stadt wählen</div>
          <div class="badges">
            <div class="badge" id="aqiCategory" aria-label="AQI-Kategorie">–</div>
            <div class="badge" id="trafficCategory" aria-label="Verkehrskategorie">–</div>
          </div>
        </div>

        <div class="stats">
          <div class="kpi" role="group" aria-labelledby="aqiLabel">
            <h4 id="aqiLabel">LUFTQUALITÄT (AQI US)</h4>
            <div class="val" id="aqiVal" title="US AQI">—</div>
          </div>
          <div class="kpi" role="group" aria-labelledby="trafficLabel">
            <h4 id="trafficLabel">VERKEHRSDICHTE</h4>
            <div class="val" id="trafficVal" title="Verkehrsdichte 0–1">—</div>
          </div>
          <div class="kpi" role="group" aria-labelledby="pm25Label">
            <h4 id="pm25Label">PM2.5</h4>
            <div class="val"><span id="pm25">—</span><span class="unit">µg/m³</span></div>
          </div>
          <div class="kpi" role="group" aria-labelledby="pm10Label">
            <h4 id="pm10Label">PM10</h4>
            <div class="val"><span id="pm10">—</span><span class="unit">µg/m³</span></div>
          </div>
        </div>

        <div class="meta">
          <div class="item">Trend 1h: <span id="trend1h">—</span></div>
          <div class="item">Trend 24h: <span id="trend24h">—</span></div>
          <div class="item">Zuletzt aktualisiert: <span id="updated">—</span></div>
          <div class="item">Quelle: <span id="source">—</span></div>
        </div>

        <div class="chart-card" id="graph">
          <div class="chart-title">Verlauf: AQI ↔ Verkehr</div>
          <div class="legend" aria-hidden="true">
            <span class="dot aqi"></span>AQI
            <span class="dot traf"></span>Verkehr
          </div>
          <canvas id="lineChart" height="180" aria-label="Liniendiagramm AQI und Verkehr über Monate"></canvas>
        </div>
      </aside>
    </main>

    <footer class="shell">
      <div class="foot">
        <span>© <span id="year"></span> Smog Bhārat</span>
        <span id="about">Dark UI · Akzentfarben Hellblau & Violett · Demo-Daten</span>
      </div>
    </footer>
  </div>

  <script src="./js/script.js?v=2" defer></script>
</body>
</html>


/* style.css (modernisiert, dark, an Referenz angelehnt) */
:root {
  --bg: #05070d;
  --bg-1: #0a0f1d;
  --bg-2: #07101b;
  --panel: #0e1322;
  --panel-soft: #121a2c;
  --border: #2b3a5b;
  --text: #e9eefc;
  --muted: #a7b6d7;
  --blue: #69a8ff;
  --violet: #9b7aff;
  --green: #4ade80;
  --orange: #f59e0b;
  --red: #f43f5e;
  --radius: 18px;
  --shadow: 0 20px 60px rgba(0,0,0,.35);
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: 'Clash Grotesk', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji', 'Segoe UI Emoji';
  color: var(--text);
  background:
    radial-gradient(1200px 700px at 75% 85%, rgba(23,48,94,.37), transparent 60%),
    radial-gradient(900px 600px at 20% 30%, rgba(70,35,140,.28), transparent 60%),
    linear-gradient(180deg, var(--bg-1), var(--bg-2)), var(--bg);
}

.shell { max-width: 1280px; margin: 0 auto; padding: 18px 20px; }

/* Header */
header { position: sticky; top: 0; z-index: 40; backdrop-filter: blur(8px);
  background: linear-gradient(to bottom, rgba(5,7,13,.75), rgba(5,7,13,.25)); border-bottom: 1px solid rgba(105,168,255,.08); }
.nav { display: flex; align-items: center; gap: 24px; }
.brand { display: flex; flex-direction: column; line-height: 1; }
.brand strong { font-weight: 800; font-size: 20px; letter-spacing: .4px; }
.brand span { font-size: 12px; color: var(--muted); opacity: .9; }
.spacer { flex: 1; }
.navlinks { display: flex; gap: 28px; }
.navlinks a { font-size: 15px; opacity: .9; }

/* Main layout */
main { display: grid; gap: 24px; grid-template-columns: 1.1fr .9fr; align-items: start; }
.map-col { min-width: 0; }

/* Map */
#map { width: 100%; height: clamp(420px, 62dvh, 720px); border-radius: var(--radius); overflow: hidden; border: 1px solid var(--border); box-shadow: var(--shadow); }
.maplibregl-canvas { outline: none; }

/* Marker */
.marker { width: 18px; height: 18px; border: 3px solid rgba(255,255,255,.9); background: var(--blue); border-radius: 999px; box-shadow: 0 0 0 10px rgba(105,168,255,.18); cursor: pointer; transition: transform .18s ease, box-shadow .2s ease; }
.marker:hover { transform: scale(1.06); box-shadow: 0 0 0 12px rgba(155,122,255,.22); }
.marker:focus-visible { outline: 3px solid var(--violet); }

/* Panel */
.panel { padding: 18px; border-radius: calc(var(--radius) + 2px); border: 1px solid rgba(105,168,255,.45); background: linear-gradient(180deg, rgba(13,20,38,.9), rgba(10,15,28,.9)); box-shadow: var(--shadow); animation: slideIn .4s ease both; }
@keyframes slideIn { from { opacity: 0; transform: translateY(4px);} to { opacity: 1; transform: translateY(0);} }
.panel .header { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
.city { font-size: clamp(22px, 3.4vw, 40px); font-weight: 800; letter-spacing: .3px; }
.badges { display: grid; gap: 12px; }
.badge { padding: 10px 14px; border-radius: 14px; background: #2a3a66; color: #e6f0ff; font-weight: 700; width: max-content; box-shadow: inset 0 1px 0 rgba(255,255,255,.05); }

.stats { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px; align-items: start; }
.kpi { background: var(--panel-soft); border: 1px solid rgba(105,168,255,.15); border-radius: 14px; padding: 14px; box-shadow: inset 0 1px 0 rgba(255,255,255,.03); }
.kpi h4 { margin: 0 0 8px; font-size: 13px; color: var(--muted); font-weight: 700; letter-spacing: .2px; }
.kpi .val { font-size: clamp(28px, 3.7vw, 44px); font-weight: 800; }
.kpi .unit { font-size: 13px; color: var(--muted); margin-left: 8px; }

.meta { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-top: 12px; }
.meta .item { font-size: 13px; color: var(--muted); }

.chart-card { margin-top: 16px; background: var(--panel-soft); border: 1px solid rgba(105,168,255,.15); border-radius: 14px; padding: 14px; }
.chart-title { font-weight: 800; margin: 2px 0 10px; letter-spacing: .2px; }
.legend { display: flex; gap: 16px; font-size: 12px; color: var(--muted); align-items: center; }
.legend .dot { width: 10px; height: 10px; border-radius: 999px; display: inline-block; }
.legend .aqi { background: var(--blue); }
.legend .traf { background: var(--violet); }

footer { opacity: .85; border-top: 1px solid rgba(105,168,255,.08); }
.foot { display: flex; gap: 16px; align-items: center; justify-content: space-between; font-size: 13px; color: var(--muted); }

/* Accessibility & Motion */
:focus-visible { outline: 3px solid var(--blue); outline-offset: 2px; border-radius: 8px; }
@media (prefers-reduced-motion: reduce) { * { transition: none !important; animation: none !important; } }

/* Responsive */
@media (max-width: 1024px) { main { grid-template-columns: 1fr; } #map { height: clamp(360px, 48dvh, 560px); } }
@media (max-width: 560px) { .navlinks { display: none; } .meta { grid-template-columns: 1fr; } .stats { grid-template-columns: 1fr 1fr; } }


// script.js (funktional, demo-daten; an Screens & Text angelehnt)
const $$ = sel => document.querySelector(sel);
const formatTime = (d = new Date()) => new Intl.DateTimeFormat('de-CH', {dateStyle:'medium', timeStyle:'short'}).format(d);

function aqiCategory(aqi){
  if (aqi == null) return { label: '—', color: '#2a3a66' };
  if (aqi <= 50) return { label: 'Gut', color: '#22c55e' };
  if (aqi <= 100) return { label: 'Moderat', color: '#69a8ff' };
  if (aqi <= 150) return { label: 'Ungesund f. Empf.', color: '#f59e0b' };
  if (aqi <= 200) return { label: 'Ungesund', color: '#f97316' };
  if (aqi <= 300) return { label: 'Sehr ungesund', color: '#ef4444' };
  return { label: 'Gefährlich', color: '#991b1b' };
}

function trafficBadge(v){
  if (v == null) return { label: '—', color: '#2a3a66'};
  if (v < .3) return { label: 'Niedrig', color: '#22c55e'};
  if (v < .6) return { label: 'Mittel', color: '#69a8ff'};
  if (v < .8) return { label: 'Hoch', color: '#9b7aff'};
  return { label: 'Sehr hoch', color: '#7c3aed'};
}

// Map
const map = new maplibregl.Map({
  container: 'map',
  style: 'https://demotiles.maplibre.org/style.json',
  center: [78.9629, 22.5937],
  zoom: 3.9,
  attributionControl: false
});
map.addControl(new maplibregl.NavigationControl({visualizePitch: true}), 'top-right');

// Demo-Städte (klickbare Punkte)
const cities = [
  { name: 'Mumbai', coord: [72.8777, 19.0760], station: 'IN-MUM-1' },
  { name: 'Delhi', coord: [77.1025, 28.7041], station: 'IN-DEL-1' },
  { name: 'Bengaluru', coord: [77.5946, 12.9716], station: 'IN-BLR-1' },
  { name: 'Hyderabad', coord: [78.4867, 17.3850], station: 'IN-HYD-1' },
  { name: 'Kochi', coord: [76.2711, 9.9312], station: 'IN-COK-1' }
];

cities.forEach(c => {
  const el = document.createElement('div');
  el.className = 'marker';
  el.title = c.name;
  el.tabIndex = 0;
  el.addEventListener('click', () => selectCity(c));
  el.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); selectCity(c); }});
  new maplibregl.Marker({ element: el, anchor: 'center' }).setLngLat(c.coord).addTo(map);
});

// Chart (glow-Look durch transparentes Fill)
const ctx = document.getElementById('lineChart');
const gradientAQI = (ctx)=>{ const g = ctx.createLinearGradient(0,0,0,180); g.addColorStop(0,'rgba(105,168,255,.35)'); g.addColorStop(1,'rgba(105,168,255,0)'); return g; };
const gradientTraf = (ctx)=>{ const g = ctx.createLinearGradient(0,0,0,180); g.addColorStop(0,'rgba(155,122,255,.35)'); g.addColorStop(1,'rgba(155,122,255,0)'); return g; };

const chart = new Chart(ctx, {
  type: 'line',
  data: { labels: [], datasets: [
    { label: 'AQI', data: [], tension: .35, borderWidth: 2, pointRadius: 0, borderColor: '#69a8ff', fill: true, backgroundColor: (c)=> gradientAQI(c.chart.ctx) },
    { label: 'Verkehr', data: [], tension: .35, borderWidth: 2, pointRadius: 0, borderColor: '#9b7aff', fill: true, backgroundColor: (c)=> gradientTraf(c.chart.ctx) }
  ]},
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: { legend: { display: false }, tooltip: { intersect: false, mode: 'index' } },
    scales: {
      x: { grid: { color: 'rgba(105,168,255,.08)' }, ticks: { color: '#9fb3d9' } },
      y: { grid: { color: 'rgba(105,168,255,.08)' }, ticks: { color: '#9fb3d9' } }
    }
  }
});

// Demo-Daten (mehrere Monate)
function mockSeries(months = 4){
  const labels = [];
  const aqi = [];
  const traffic = [];
  const now = new Date();
  const days = months * 30;
  let a = 70 + Math.random()*60;
  let t = .35 + Math.random()*.4;
  for (let i = days; i >= 0; i--){
    const d = new Date(now); d.setDate(now.getDate() - i);
    labels.push(d.toLocaleDateString('de-CH', { month:'short', day:'2-digit'}));
    a += (Math.random()-.5)*10; aqi.push(Math.max(20, Math.min(220, Math.round(a))));
    t += (Math.random()-.5)*.05; traffic.push(Math.max(.1, Math.min(.95, +t.toFixed(2))));
  }
  return { labels, aqi, traffic };
}

async function fetchAQI(city){
  // Platzhalter – hier später echte AQI-US-Quelle (OpenAQ/WAQI) einhängen
  const base = Math.floor(40 + Math.random()*120);
  return {
    city: city.name,
    station: city.station,
    aqi: base,
    pm25: (10 + Math.random()*60).toFixed(1),
    pm10: (20 + Math.random()*80).toFixed(1),
    trend1h: ['↑','→','↓'][Math.floor(Math.random()*3)],
    trend24h: ['↑','→','↓'][Math.floor(Math.random()*3)],
    updatedAt: new Date(),
    source: 'Demo AQI'
  };
}

async function fetchTraffic(city){
  // Platzhalter – hier später TomTom Traffic Flow einhängen
  return { value: +(0.3 + Math.random()*0.6).toFixed(2), source: 'Demo Traffic' };
}

function updatePanel(data){
  $$('#city').textContent = data.city;
  $$('#aqiVal').textContent = data.aqi;
  $$('#pm25').textContent = data.pm25;
  $$('#pm10').textContent = data.pm10;
  $$('#trend1h').textContent = data.trend1h;
  $$('#trend24h').textContent = data.trend24h;
  $$('#updated').textContent = formatTime(data.updatedAt);
  $$('#source').textContent = data.source;

  const cat = aqiCategory(data.aqi); const catEl = $$('#aqiCategory');
  catEl.textContent = cat.label; catEl.style.background = cat.color;

  const traf = trafficBadge(data.trafficVal); const tEl = $$('#trafficCategory');
  tEl.textContent = traf.label; tEl.style.background = traf.color;

  $$('#trafficVal').textContent = data.trafficVal;
}

function updateChart(series){
  chart.data.labels = series.labels;
  chart.data.datasets[0].data = series.aqi;
  chart.data.datasets[1].data = series.traffic.map(v => Math.round(v*100));
  chart.update();
}

async function selectCity(city){
  map.easeTo({ center: city.coord, zoom: 5.2, duration: 900 });
  document.body.style.cursor = 'progress';
  try {
    const [aqi, traffic] = await Promise.all([fetchAQI(city), fetchTraffic(city)]);
    const combined = { ...aqi, trafficVal: traffic.value, source: `${aqi.source} + ${traffic.source}` };
    updatePanel(combined);
    updateChart(mockSeries(4));
  } catch (e){
    console.error(e);
  } finally {
    document.body.style.cursor = '';
  }
}

// Init
$$('#year').textContent = new Date().getFullYear();
window.addEventListener('load', () => selectCity(cities[0]));
